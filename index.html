<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>富文本编辑器-小程序内容配置</title>
    <!-- 引入wangEditor核心库 -->
    <script src="https://cdn.jsdelivr.net/npm/wangeditor@4.7.12/dist/wangEditor.min.js"></script>
    <!-- 引入字体图标（用于按钮和交互） -->
    <link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: "Microsoft Yahei", sans-serif;
            background-color: #f5f7fa;
            padding: 20px;
        }

        /* 页面整体布局 */
        .container {
            display: flex;
            gap: 20px;
            max-width: 1400px;
            margin: 0 auto;
        }

        /* 编辑器区域 */
        .editor-wrap {
            flex: 1;
            background: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            padding: 20px;
        }

        /* 功能按钮区 */
        .tool-bar {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .tool-btn {
            padding: 8px 16px;
            background: #409eff;
            color: #fff;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
            transition: background 0.2s;
        }

        .tool-btn:hover {
            background: #66b1ff;
        }

        .tool-btn.secondary {
            background: #909399;
        }

        .tool-btn.secondary:hover {
            background: #a6a9ad;
        }

        /* 目录区域 */
        .catalog-wrap {
            margin-bottom: 15px;
            padding: 10px;
            border: 1px solid #e6e6e6;
            border-radius: 4px;
        }

        .catalog-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #333;
        }

        .catalog-list {
            list-style: none;
            padding-left: 10px;
        }

        .catalog-item {
            margin: 5px 0;
        }

        .catalog-item a {
            color: #409eff;
            text-decoration: none;
            cursor: pointer;
        }

        .catalog-item a:hover {
            text-decoration: underline;
        }

        /* 编辑器容器 */
        #editor {
            height: 500px;
            border: 1px solid #e6e6e6;
            border-radius: 4px;
        }

        /* 手机预览区域 */
        .preview-wrap {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        /* 手机模拟器样式 */
        .phone-simulator {
            width: 375px;
            height: 812px;
            border: 16px solid #333;
            border-radius: 36px;
            position: relative;
            background: #fff;
            overflow: hidden;
        }

        /* 手机顶部状态栏 */
        .phone-status-bar {
            height: 44px;
            background: #000;
            color: #fff;
            padding: 0 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 12px;
        }

        /* 预览内容区域 */
        .preview-content {
            height: calc(100% - 44px);
            overflow-y: auto;
            padding: 15px;
            font-size: 16px;
            line-height: 1.6;
        }

        /* 折叠组件样式 */
        .collapse-wrap {
            margin: 15px 0;
            border: 1px solid #e6e6e6;
            border-radius: 4px;
        }

        .collapse-header {
            padding: 10px 15px;
            background: #f5f5f5;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .collapse-content {
            padding: 0 15px;
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }

        .collapse-content.show {
            padding: 15px;
            max-height: 1000px;
        }

        /* 卡牌轮播样式 */
        .card-swiper {
            margin: 15px 0;
            position: relative;
            overflow: hidden;
            border-radius: 8px;
        }

        .swiper-wrapper {
            display: flex;
            transition: transform 0.3s ease;
        }

        .swiper-item {
            flex: 0 0 100%;
            padding: 15px;
            background: #f9f9f9;
            border: 1px solid #e6e6e6;
        }

        .swiper-nav {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-top: 10px;
        }

        .swiper-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #ccc;
            cursor: pointer;
        }

        .swiper-dot.active {
            background: #409eff;
        }

        .swiper-arrow {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: rgba(0,0,0,0.5);
            color: #fff;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 10;
        }

        .swiper-prev {
            left: 10px;
        }

        .swiper-next {
            right: 10px;
        }

        /* 响应式适配 */
        @media (max-width: 1024px) {
            .container {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- 左侧编辑器区域 -->
        <div class="editor-wrap">
            <div class="tool-bar">
                <button class="tool-btn" id="genCatalogBtn">
                    <i class="fas fa-list"></i> 自动生成目录
                </button>
                <button class="tool-btn" id="insertCollapseBtn">
                    <i class="fas fa-chevron-down"></i> 插入折叠内容
                </button>
                <button class="tool-btn" id="insertCardBtn">
                    <i class="fas fa-th"></i> 插入卡牌轮播
                </button>
                <button class="tool-btn secondary" id="refreshPreviewBtn">
                    <i class="fas fa-sync"></i> 刷新预览
                </button>
            </div>

            <!-- 目录区域 -->
            <div class="catalog-wrap">
                <div class="catalog-title">文章目录</div>
                <ul class="catalog-list" id="catalogList"></ul>
            </div>

            <!-- 富文本编辑器 -->
            <div id="editor"></div>
        </div>

        <!-- 右侧手机预览区域 -->
        <div class="preview-wrap">
            <h3 style="margin-bottom: 20px;">手机预览效果</h3>
            <div class="phone-simulator">
                <div class="phone-status-bar">
                    <span>9:41</span>
                    <span><i class="fas fa-signal"></i> <i class="fas fa-wifi"></i></span>
                </div>
                <div class="preview-content" id="previewContent"></div>
            </div>
        </div>
    </div>

    <script>
        // 初始化wangEditor编辑器
        const E = window.wangEditor
        const editor = new E('#editor')
        
        // 配置编辑器
        editor.config.height = 500
        editor.config.zIndex = 100
        // 允许粘贴图片
        editor.config.uploadImgShowBase64 = true
        // 关闭XSS过滤（仅用于演示，生产环境需开启）
        editor.config.xss = false

        // 初始化编辑器
        editor.create()

        // ===================== 核心功能实现 =====================

        // 1. 自动生成目录（提取H1/H2/H3标题，生成锚点）
        const genCatalogBtn = document.getElementById('genCatalogBtn')
        const catalogList = document.getElementById('catalogList')
        
        genCatalogBtn.addEventListener('click', function() {
            const html = editor.txt.html()
            const tempDiv = document.createElement('div')
            tempDiv.innerHTML = html
            
            // 提取所有H1/H2/H3标签
            const headings = tempDiv.querySelectorAll('h1, h2, h3')
            catalogList.innerHTML = ''
            
            // 为每个标题添加唯一ID，并生成目录
            headings.forEach((heading, index) => {
                const id = `heading-${index}`
                heading.id = id
                
                // 创建目录项
                const li = document.createElement('li')
                li.className = `catalog-item catalog-${heading.tagName.toLowerCase()}`
                li.innerHTML = `<a href="javascript:void(0)" data-id="${id}">${heading.innerText}</a>`
                catalogList.appendChild(li)
                
                // 目录点击跳转锚点
                li.querySelector('a').addEventListener('click', function() {
                    const previewContent = document.getElementById('previewContent')
                    const target = previewContent.querySelector(`#${this.dataset.id}`)
                    if (target) {
                        // 预览区滚动到目标位置
                        target.scrollIntoView({ behavior: 'smooth' })
                        // 高亮目标标题（2秒后取消）
                        target.style.backgroundColor = '#e6f7ff'
                        setTimeout(() => {
                            target.style.backgroundColor = ''
                        }, 2000)
                    }
                })
            })
            
            // 如果没有标题
            if (headings.length === 0) {
                catalogList.innerHTML = '<li style="color:#999;">暂无标题，请先添加H1/H2/H3标题</li>'
            }
            
            // 刷新预览
            refreshPreview()
        })

        // 2. 插入折叠内容组件
        const insertCollapseBtn = document.getElementById('insertCollapseBtn')
        insertCollapseBtn.addEventListener('click', function() {
            const collapseHtml = `
                <div class="collapse-wrap">
                    <div class="collapse-header" onclick="this.nextElementSibling.classList.toggle('show'); this.querySelector('.icon').classList.toggle('fa-chevron-down'); this.querySelector('.icon').classList.toggle('fa-chevron-up')">
                        <span>点击展开/折叠内容</span>
                        <i class="fas fa-chevron-down icon"></i>
                    </div>
                    <div class="collapse-content">
                        <p>这里是可折叠的内容，运营可自定义修改...</p>
                        <p>支持图文混排、列表等富文本格式</p>
                    </div>
                </div>
            `
            // 插入到编辑器
            editor.txt.append(collapseHtml)
            // 刷新预览
            refreshPreview()
        })

        // 3. 插入卡牌轮播组件
        const insertCardBtn = document.getElementById('insertCardBtn')
        insertCardBtn.addEventListener('click', function() {
            const cardHtml = `
                <div class="card-swiper">
                    <div class="swiper-wrapper">
                        <div class="swiper-item">
                            <h4>卡牌1</h4>
                            <p>这是第一张卡牌的内容，可自定义修改</p>
                        </div>
                        <div class="swiper-item">
                            <h4>卡牌2</h4>
                            <p>这是第二张卡牌的内容，可自定义修改</p>
                        </div>
                        <div class="swiper-item">
                            <h4>卡牌3</h4>
                            <p>这是第三张卡牌的内容，可自定义修改</p>
                        </div>
                    </div>
                    <div class="swiper-arrow swiper-prev" onclick="swiperPrev(this)"><i class="fas fa-chevron-left"></i></div>
                    <div class="swiper-arrow swiper-next" onclick="swiperNext(this)"><i class="fas fa-chevron-right"></i></div>
                    <div class="swiper-nav">
                        <div class="swiper-dot active" onclick="swiperGo(this, 0)"></div>
                        <div class="swiper-dot" onclick="swiperGo(this, 1)"></div>
                        <div class="swiper-dot" onclick="swiperGo(this, 2)"></div>
                    </div>
                </div>
            `
            // 插入到编辑器
            editor.txt.append(cardHtml)
            // 刷新预览
            refreshPreview()
        })

        // 4. 刷新预览功能
        const refreshPreviewBtn = document.getElementById('refreshPreviewBtn')
        const previewContent = document.getElementById('previewContent')
        
        function refreshPreview() {
            // 获取编辑器内容并渲染到预览区
            previewContent.innerHTML = editor.txt.html()
            
            // 初始化预览区的轮播功能
            initSwiper(previewContent)
        }
        
        refreshPreviewBtn.addEventListener('click', refreshPreview)

        // 5. 卡牌轮播核心逻辑
        function initSwiper(container) {
            const swipers = container.querySelectorAll('.card-swiper')
            
            swipers.forEach(swiper => {
                const wrapper = swiper.querySelector('.swiper-wrapper')
                const dots = swiper.querySelectorAll('.swiper-dot')
                const items = swiper.querySelectorAll('.swiper-item')
                let currentIndex = 0

                // 轮播切换函数
                function updateSwiper(index) {
                    currentIndex = index
                    // 移动轮播容器
                    wrapper.style.transform = `translateX(-${index * 100}%)`
                    // 更新指示器
                    dots.forEach((dot, i) => {
                        dot.classList.toggle('active', i === index)
                    })
                }

                // 绑定上一页/下一页事件
                swiper.querySelector('.swiper-prev').onclick = function() {
                    currentIndex = (currentIndex - 1 + items.length) % items.length
                    updateSwiper(currentIndex)
                }
                
                swiper.querySelector('.swiper-next').onclick = function() {
                    currentIndex = (currentIndex + 1) % items.length
                    updateSwiper(currentIndex)
                }

                // 绑定指示器点击事件
                dots.forEach((dot, index) => {
                    dot.onclick = function() {
                        updateSwiper(index)
                    }
                })
            })
        }

        // 全局轮播函数（供HTML内联调用）
        window.swiperPrev = function(el) {
            el.closest('.card-swiper').querySelector('.swiper-prev').click()
        }
        window.swiperNext = function(el) {
            el.closest('.card-swiper').querySelector('.swiper-next').click()
        }
        window.swiperGo = function(el, index) {
            const swiper = el.closest('.card-swiper')
            const dots = swiper.querySelectorAll('.swiper-dot')
            const wrapper = swiper.querySelector('.swiper-wrapper')
            
            wrapper.style.transform = `translateX(-${index * 100}%)`
            dots.forEach((dot, i) => {
                dot.classList.toggle('active', i === index)
            })
        }

        // 实时预览（编辑器内容变化时自动刷新）
        editor.txt.eventHooks.change = function() {
            // 防抖处理，避免频繁刷新
            clearTimeout(window.previewTimer)
            window.previewTimer = setTimeout(refreshPreview, 500)
        }

        // 初始化预览
        refreshPreview()
    </script>
</body>
</html>